import{a1 as Re,ad as Se,ac as _e}from"./3bhyZd_0.js";function Ee(e){return e.charAt(0).toUpperCase()+e.slice(1)}var Te={},re={};const W=Object.create(null),F=e=>Te||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?W:globalThis),k=new Proxy(W,{get(e,t){return F()[t]??W[t]},has(e,t){return t in F()||t in W},set(e,t,n){const r=F(!0);return r[t]=n,!0},deleteProperty(e,t){if(!t)return!1;const n=F(!0);return delete n[t],!0},ownKeys(){const e=F(!0);return Object.keys(e)}});function g(e,t){return typeof process<"u"&&re?re[e]??t:typeof Deno<"u"?Deno.env.get(e)??t:typeof Bun<"u"?Bun.env[e]??t:t}const B=1,m=4,L=8,R=24,se={eterm:m,cons25:m,console:m,cygwin:m,dtterm:m,gnome:m,hurd:m,jfbterm:m,konsole:m,kterm:m,mlterm:m,mosh:R,putty:m,st:m,"rxvt-unicode-24bit":R,terminator:R,"xterm-kitty":R},Pe=new Map(Object.entries({APPVEYOR:L,BUILDKITE:L,CIRCLECI:R,DRONE:L,GITEA_ACTIONS:R,GITHUB_ACTIONS:R,GITLAB_CI:L,TRAVIS:L})),Le=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function Ie(){if(g("FORCE_COLOR")!==void 0)switch(g("FORCE_COLOR")){case"":case"1":case"true":return m;case"2":return L;case"3":return R;default:return B}if(g("NODE_DISABLE_COLORS")!==void 0&&g("NODE_DISABLE_COLORS")!==""||g("NO_COLOR")!==void 0&&g("NO_COLOR")!==""||g("TERM")==="dumb")return B;if(g("TMUX"))return R;if("TF_BUILD"in k&&"AGENT_NAME"in k)return m;if("CI"in k){for(const{0:e,1:t}of Pe)if(e in k)return t;return g("CI_NAME")==="codeship"?L:B}if("TEAMCITY_VERSION"in k)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(g("TEAMCITY_VERSION"))!==null?m:B;switch(g("TERM_PROGRAM")){case"iTerm.app":return!g("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(g("TERM_PROGRAM_VERSION"))!==null?L:R;case"HyperTerm":case"MacTerm":return R;case"Apple_Terminal":return L}if(g("COLORTERM")==="truecolor"||g("COLORTERM")==="24bit")return R;if(g("TERM")){if(/truecolor/.exec(g("TERM"))!==null)return R;if(/^xterm-256/.exec(g("TERM"))!==null)return L;const e=g("TERM").toLowerCase();if(se[e])return se[e];if(Le.some(t=>t.exec(e)!==null))return m}return g("COLORTERM")?m:B}const I={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},K=["info","success","warn","error","debug"];function Ae(e,t){return K.indexOf(t)<=K.indexOf(e)}const xe={info:I.fg.blue,success:I.fg.green,warn:I.fg.yellow,error:I.fg.red,debug:I.fg.magenta},Ce=(e,t,n)=>{const r=new Date().toISOString();return n?`${I.dim}${r}${I.reset} ${xe[e]}${e.toUpperCase()}${I.reset} ${I.bright}[Better Auth]:${I.reset} ${t}`:`${r} ${e.toUpperCase()} [Better Auth]: ${t}`},Me=e=>{const t="error",n=Ie()!==1,r=(s,u,a=[])=>{if(!Ae(t,s))return;const d=Ce(s,u,n)};return{...Object.fromEntries(K.map(s=>[s,(...[u,...a])=>r(s,u,a)])),get level(){return t}}};Me();var G=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};function Ne(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new G(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function Ue(e){try{const t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new G(`Invalid base URL: ${e}. URL must include 'http://' or 'https://'`)}catch(t){throw t instanceof G?t:new G(`Invalid base URL: ${e}. Please provide a valid base URL.`,String(t))}}function oe(e,t="/api/auth"){if(Ue(e),Ne(e))return e;const n=e.replace(/\/+$/,"");return!t||t==="/"?n:(t=t.startsWith("/")?t:`/${t}`,`${n}${t}`)}function qe(e,t,n,r,s){if(e)return oe(e,t);if(typeof window<"u"&&window.location)return oe(window.location.origin,t)}const Fe={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},ke=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,ie={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},Be=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function De(e){return e instanceof Date&&!isNaN(e.getTime())}function $e(e){const t=Be.exec(e);if(!t)return null;const[,n,r,s,u,a,d,i,l,o,f]=t;let h=new Date(Date.UTC(parseInt(n,10),parseInt(r,10)-1,parseInt(s,10),parseInt(u,10),parseInt(a,10),parseInt(d,10),i?parseInt(i.padEnd(3,"0"),10):0));if(l){const O=(parseInt(o,10)*60+parseInt(f,10))*(l==="+"?-1:1);h.setUTCMinutes(h.getUTCMinutes()+O)}return De(h)?h:null}function je(e,t={}){const{strict:n=!1,warnings:r=!1,reviver:s,parseDates:u=!0}=t;if(typeof e!="string")return e;const a=e.trim();if(a.length>0&&a[0]==='"'&&a.endsWith('"')&&!a.slice(1,-1).includes('"'))return a.slice(1,-1);const d=a.toLowerCase();if(d.length<=9&&d in ie)return ie[d];if(!ke.test(a)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Fe).some(([i,l])=>{const o=l.test(a);return o})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(a,(l,o)=>{if(!(l==="__proto__"||l==="constructor"&&o&&typeof o=="object"&&"prototype"in o)){if(u&&typeof o=="string"){const f=$e(o);if(f)return f}return s?s(l,o):o}})}catch(i){if(n)throw i;return e}}function Ve(e,t={strict:!0}){return je(e,t)}let E=[],N=0;const $=4,pe=e=>{let t=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(r){return n.lc=t.push(r),()=>{for(let u=N+$;u<E.length;)E[u]===r?E.splice(u,$):u+=$;let s=t.indexOf(r);~s&&(t.splice(s,1),--n.lc||n.off())}},notify(r,s){let u=!E.length;for(let a of t)E.push(a,n.value,r,s);if(u){for(N=0;N<E.length;N+=$)E[N](E[N+1],E[N+2],E[N+3]);E.length=0}},off(){},set(r){let s=n.value;s!==r&&(n.value=r,n.notify(s))},subscribe(r){let s=n.listen(r);return r(n.value),s},value:e};return n},We=5,j=6,V=10;let Ge=(e,t,n,r)=>(e.events=e.events||{},e.events[n+V]||(e.events[n+V]=r(s=>{e.events[n].reduceRight((u,a)=>(a(u),u),{shared:{},...s})})),e.events[n]=e.events[n]||[],e.events[n].push(t),()=>{let s=e.events[n],u=s.indexOf(t);s.splice(u,1),s.length||(delete e.events[n],e.events[n+V](),delete e.events[n+V])}),Je=1e3,ge=(e,t)=>Ge(e,r=>{let s=t(r);s&&e.events[j].push(s)},We,r=>{let s=e.listen;e.listen=(...a)=>(!e.lc&&!e.active&&(e.active=!0,r()),s(...a));let u=e.off;return e.events[j]=[],e.off=()=>{u(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let a of e.events[j])a();e.events[j]=[]}},Je)},()=>{e.listen=s,e.off=u}});var He=Object.defineProperty,Ye=Object.defineProperties,Qe=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertySymbols,Xe=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable,ue=(e,t,n)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T=(e,t)=>{for(var n in t||(t={}))Xe.call(t,n)&&ue(e,n,t[n]);if(ae)for(var n of ae(t))ze.call(t,n)&&ue(e,n,t[n]);return e},P=(e,t)=>Ye(e,Qe(t)),Ze=class extends Error{constructor(e,t,n){super(t||e.toString(),{cause:n}),this.status=e,this.statusText=t,this.error=n}},Ke=async(e,t)=>{var n,r,s,u,a,d;let i=t||{};const l={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:i,hooks:l};for(const o of t?.plugins||[]){if(o.init){const f=await((n=o.init)==null?void 0:n.call(o,e.toString(),t));i=f.options||i,e=f.url}l.onRequest.push((r=o.hooks)==null?void 0:r.onRequest),l.onResponse.push((s=o.hooks)==null?void 0:s.onResponse),l.onSuccess.push((u=o.hooks)==null?void 0:u.onSuccess),l.onError.push((a=o.hooks)==null?void 0:a.onError),l.onRetry.push((d=o.hooks)==null?void 0:d.onRetry)}return{url:e,options:i,hooks:l}},ce=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},et=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function tt(e){if(typeof e=="number")return new ce({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new ce(e);case"exponential":return new et(e);default:throw new Error("Invalid retry strategy")}}var nt=async e=>{const t={},n=async r=>typeof r=="function"?await r():r;if(e?.auth){if(e.auth.type==="Bearer"){const r=await n(e.auth.token);if(!r)return t;t.authorization=`Bearer ${r}`}else if(e.auth.type==="Basic"){const r=n(e.auth.username),s=n(e.auth.password);if(!r||!s)return t;t.authorization=`Basic ${btoa(`${r}:${s}`)}`}else if(e.auth.type==="Custom"){const r=n(e.auth.value);if(!r)return t;t.authorization=`${n(e.auth.prefix)} ${r}`}}return t},rt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function st(e){const t=e.headers.get("content-type"),n=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const r=t.split(";").shift()||"";return rt.test(r)?"json":n.has(r)||r.startsWith("text/")?"text":"blob"}function ot(e){try{return JSON.parse(e),!0}catch{return!1}}function ye(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function le(e){try{return JSON.parse(e)}catch{return e}}function fe(e){return typeof e=="function"}function it(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&fe(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&fe(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function at(e){const t=new Headers(e?.headers),n=await nt(e);for(const[r,s]of Object.entries(n||{}))t.set(r,s);if(!t.has("content-type")){const r=ut(e?.body);r&&t.set("content-type",r)}return t}function ut(e){return ye(e)?"application/json":null}function ct(e){if(!e?.body)return null;const t=new Headers(e?.headers);if(ye(e.body)&&!t.has("content-type")){for(const[n,r]of Object.entries(e?.body))r instanceof Date&&(e.body[n]=r.toISOString());return JSON.stringify(e.body)}return e.body}function lt(e,t){var n;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const r=(n=e.split("@")[1])==null?void 0:n.split("/")[0];return ve.includes(r)?r.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function ft(e,t){let n;return!e?.signal&&e?.timeout&&(n=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:n,clearTimeout:()=>{n&&clearTimeout(n)}}}var dt=class me extends Error{constructor(t,n){super(n||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,me.prototype)}};async function J(e,t){let n=await e["~standard"].validate(t);if(n.issues)throw new dt(n.issues);return n.value}var ve=["get","post","put","patch","delete"],ht=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,n){var r,s,u,a;const d=((s=(r=e.plugins)==null?void 0:r.find(i=>{var l;return(l=i.schema)!=null&&l.config?t.startsWith(i.schema.config.baseURL||"")||t.startsWith(i.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(d){let i=t;(u=d.config)!=null&&u.prefix&&i.startsWith(d.config.prefix)&&(i=i.replace(d.config.prefix,""),d.config.baseURL&&(t=t.replace(d.config.prefix,d.config.baseURL))),(a=d.config)!=null&&a.baseURL&&i.startsWith(d.config.baseURL)&&(i=i.replace(d.config.baseURL,""));const l=d.schema[i];if(l){let o=P(T({},n),{method:l.method,output:l.output});return n?.disableValidation||(o=P(T({},o),{body:l.input?await J(l.input,n?.body):n?.body,params:l.params?await J(l.params,n?.params):n?.params,query:l.query?await J(l.query,n?.query):n?.query})),{url:t,options:o}}}return{url:t,options:n}}}),pt=e=>{async function t(n,r){const s=P(T(T({},e),r),{plugins:[...e?.plugins||[],ht(e||{})]});if(e?.catchAllError)try{return await ee(n,s)}catch(u){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:u}}}return await ee(n,s)}return t};function gt(e,t){let{baseURL:n,params:r,query:s}=t||{query:{},params:{},baseURL:""},u=e.startsWith("http")?e.split("/").slice(0,3).join("/"):n||"";if(e.startsWith("@")){const f=e.toString().split("@")[1].split("/")[0];ve.includes(f)&&(e=e.replace(`@${f}/`,"/"))}u.endsWith("/")||(u+="/");let[a,d]=e.replace(u,"").split("?");const i=new URLSearchParams(d);for(const[f,h]of Object.entries(s||{}))h!=null&&i.set(f,String(h));if(r)if(Array.isArray(r)){const f=a.split("/").filter(h=>h.startsWith(":"));for(const[h,O]of f.entries()){const _=r[h];a=a.replace(O,_)}}else for(const[f,h]of Object.entries(r))a=a.replace(`:${f}`,String(h));a=a.split("/").map(encodeURIComponent).join("/"),a.startsWith("/")&&(a=a.slice(1));let l=i.toString();return l=l.length>0?`?${l}`.replace(/\+/g,"%20"):"",u.startsWith("http")?new URL(`${a}${l}`,u):`${u}${a}${l}`}var ee=async(e,t)=>{var n,r,s,u,a,d,i,l;const{hooks:o,url:f,options:h}=await Ke(e,t),O=it(h),_=new AbortController,C=(n=h.signal)!=null?n:_.signal,v=gt(f,h),M=ct(h),y=await at(h),b=lt(f,h);let c=P(T({},h),{url:v,headers:y,body:M,method:b,signal:C});for(const S of o.onRequest)if(S){const w=await S(c);w instanceof Object&&(c=w)}("pipeTo"in c&&typeof c.pipeTo=="function"||typeof((r=t?.body)==null?void 0:r.pipe)=="function")&&("duplex"in c||(c.duplex="half"));const{clearTimeout:U}=ft(h,_);let p=await O(c.url,c);U();const te={response:p,request:c};for(const S of o.onResponse)if(S){const w=await S(P(T({},te),{response:(s=t?.hookOptions)!=null&&s.cloneResponse?p.clone():p}));w instanceof Response?p=w:w instanceof Object&&(p=w.response)}if(p.ok){if(!(c.method!=="HEAD"))return{data:"",error:null};const w=st(p),A={data:"",response:p,request:c};if(w==="json"||w==="text"){const x=await p.text(),Oe=await((u=c.jsonParser)!=null?u:le)(x);A.data=Oe}else A.data=await p[w]();c?.output&&c.output&&!c.disableValidation&&(A.data=await J(c.output,A.data));for(const x of o.onSuccess)x&&await x(P(T({},A),{response:(a=t?.hookOptions)!=null&&a.cloneResponse?p.clone():p}));return t?.throw?A.data:{data:A.data,error:null}}const be=(d=t?.jsonParser)!=null?d:le,D=await p.text(),ne=ot(D),H=ne?await be(D):null,we={response:p,responseText:D,request:c,error:P(T({},H),{status:p.status,statusText:p.statusText})};for(const S of o.onError)S&&await S(P(T({},we),{response:(i=t?.hookOptions)!=null&&i.cloneResponse?p.clone():p}));if(t?.retry){const S=tt(t.retry),w=(l=t.retryAttempt)!=null?l:0;if(await S.shouldAttemptRetry(w,p)){for(const x of o.onRetry)x&&await x(te);const A=S.getDelay(w);return await new Promise(x=>setTimeout(x,A)),await ee(e,P(T({},t),{retryAttempt:w+1}))}}if(t?.throw)throw new Ze(p.status,p.statusText,ne?H:D);return{data:null,error:P(T({},H),{status:p.status,statusText:p.statusText})}};const Y=Symbol.for("better-auth:broadcast-channel"),yt=()=>Math.floor(Date.now()/1e3);var mt=class{listeners=new Set;name;constructor(e="better-auth.message"){this.name=e}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}post(e){if(!(typeof window>"u"))try{localStorage.setItem(this.name,JSON.stringify({...e,timestamp:yt()}))}catch{}}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=t=>{if(t.key!==this.name)return;const n=JSON.parse(t.newValue??"{}");n?.event!=="session"||!n?.data||this.listeners.forEach(r=>r(n))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}};function Q(e="better-auth.message"){return globalThis[Y]||(globalThis[Y]=new mt(e)),globalThis[Y]}const X=Symbol.for("better-auth:focus-manager");var vt=class{listeners=new Set;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setFocused(e){this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof document>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>{document.visibilityState==="visible"&&this.setFocused(!0)};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}};function de(){return globalThis[X]||(globalThis[X]=new vt),globalThis[X]}const z=Symbol.for("better-auth:online-manager");var bt=class{listeners=new Set;isOnline=typeof navigator<"u"?navigator.onLine:!0;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>this.setOnline(!0),t=()=>this.setOnline(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e,!1),window.removeEventListener("offline",t,!1)}}};function Z(){return globalThis[z]||(globalThis[z]=new bt),globalThis[z]}const wt=()=>typeof window>"u",Ot=(e,t,n,r)=>{const s=pe({data:null,error:null,isPending:!0,isRefetching:!1,refetch:d=>u(d)}),u=async d=>new Promise(i=>{const l=typeof r=="function"?r({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):r;n(t,{...l,query:{...l?.query,...d?.query},async onSuccess(o){s.set({data:o.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await l?.onSuccess?.(o)},async onError(o){const{request:f}=o,h=typeof f.retry=="number"?f.retry:f.retry?.attempts,O=f.retryAttempt||0;h&&O<h||(s.set({error:o.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await l?.onError?.(o))},async onRequest(o){const f=s.get();s.set({isPending:f.data===null,data:f.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await l?.onRequest?.(o)}}).catch(o=>{s.set({error:o,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch})}).finally(()=>{i(void 0)})});e=Array.isArray(e)?e:[e];let a=!1;for(const d of e)d.subscribe(async()=>{wt()||(a?await u():ge(s,()=>{const i=setTimeout(async()=>{a||(await u(),a=!0)},0);return()=>{s.off(),d.off(),clearTimeout(i)}}))});return s},q=()=>Math.floor(Date.now()/1e3),Rt=5;function St(e){const{sessionAtom:t,sessionSignal:n,$fetch:r,options:s={}}=e,u=s.sessionOptions?.refetchInterval??0,a=s.sessionOptions?.refetchOnWindowFocus??!0,d=s.sessionOptions?.refetchWhenOffline??!1,i={lastSync:0,lastSessionRequest:0,cachedSession:void 0},l=()=>d||Z().isOnline,o=y=>{if(!l())return;if(y?.event==="storage"){i.lastSync=q(),n.set(!n.get());return}const b=t.get();if(y?.event==="poll"){i.lastSessionRequest=q(),r("/get-session").then(c=>{t.set({...b,data:c.data,error:c.error||null}),i.lastSync=q(),n.set(!n.get())}).catch(()=>{});return}y?.event==="visibilitychange"&&q()-i.lastSessionRequest<Rt&&b?.data!==null&&b?.data!==void 0||(b?.data===null||b?.data===void 0||y?.event==="visibilitychange")&&(y?.event==="visibilitychange"&&(i.lastSessionRequest=q()),i.lastSync=q(),n.set(!n.get()))},f=y=>{Q().post({event:"session",data:{trigger:y},clientId:Math.random().toString(36).substring(7)})},h=()=>{u&&u>0&&(i.pollInterval=setInterval(()=>{t.get()?.data&&o({event:"poll"})},u*1e3))},O=()=>{i.unsubscribeBroadcast=Q().subscribe(()=>{o({event:"storage"})})},_=()=>{a&&(i.unsubscribeFocus=de().subscribe(()=>{o({event:"visibilitychange"})}))},C=()=>{i.unsubscribeOnline=Z().subscribe(y=>{y&&o({event:"visibilitychange"})})};return{init:()=>{h(),O(),_(),C(),Q().setup(),de().setup(),Z().setup()},cleanup:()=>{i.pollInterval&&(clearInterval(i.pollInterval),i.pollInterval=void 0),i.unsubscribeBroadcast&&(i.unsubscribeBroadcast(),i.unsubscribeBroadcast=void 0),i.unsubscribeFocus&&(i.unsubscribeFocus(),i.unsubscribeFocus=void 0),i.unsubscribeOnline&&(i.unsubscribeOnline(),i.unsubscribeOnline=void 0),i.lastSync=0,i.lastSessionRequest=0,i.cachedSession=void 0},triggerRefetch:o,broadcastSessionUpdate:f}}const _t={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},Et={id:"user-agent",name:"UserAgent",hooks:{onRequest(e){e.headers.append("user-agent","better-auth")}}};function Tt(e,t){const n=pe(!1),r=Ot(n,"/get-session",e,{method:"GET"});return ge(r,()=>{const s=St({sessionAtom:r,sessionSignal:n,$fetch:e,options:t});return s.init(),()=>{s.cleanup()}}),{session:r,$sessionSignal:n}}const Pt=(e,t)=>{const n="credentials"in Request.prototype,r=qe(e?.baseURL,e?.basePath)??"/api/auth",s=e?.plugins?.flatMap(c=>c.fetchPlugins).filter(c=>c!==void 0)||[],u={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:e?.fetchOptions?.onSuccess,onError:e?.fetchOptions?.onError,onRequest:e?.fetchOptions?.onRequest,onResponse:e?.fetchOptions?.onResponse}},{onSuccess:a,onError:d,onRequest:i,onResponse:l,...o}=e?.fetchOptions||{},f=pt({baseURL:r,...n?{credentials:"include"}:{},method:"GET",jsonParser(c){return c?Ve(c,{strict:!1}):null},customFetchImpl:fetch,...o,plugins:[u,...o.plugins||[],...e?.disableDefaultFetchPlugins?[]:[Et,_t],...s]}),{$sessionSignal:h,session:O}=Tt(f,e),_=e?.plugins||[];let C={},v={$sessionSignal:h,session:O},M={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const y=[{signal:"$sessionSignal",matcher(c){return c==="/sign-out"||c==="/update-user"||c==="/sign-up/email"||c==="/sign-in/email"||c==="/delete-user"||c==="/verify-email"||c==="/revoke-sessions"||c==="/revoke-session"||c==="/change-email"}}];for(const c of _)c.getAtoms&&Object.assign(v,c.getAtoms?.(f)),c.pathMethods&&Object.assign(M,c.pathMethods),c.atomListeners&&y.push(...c.atomListeners);const b={notify:c=>{v[c].set(!v[c].get())},listen:(c,U)=>{v[c].subscribe(U)},atoms:v};for(const c of _)c.getActions&&Object.assign(C,c.getActions?.(f,b,e));return{get baseURL(){return r},pluginsActions:C,pluginsAtoms:v,pluginPathMethods:M,atomListeners:y,$fetch:f,$store:b}};function Lt(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function It(e,t,n){const r=t[e],{fetchOptions:s,query:u,...a}=n||{};return r||(s?.method?s.method:a&&Object.keys(a).length>0?"POST":"GET")}function At(e,t,n,r,s){function u(a=[]){return new Proxy(function(){},{get(d,i){if(typeof i!="string"||i==="then"||i==="catch"||i==="finally")return;const l=[...a,i];let o=e;for(const f of l)if(o&&typeof o=="object"&&f in o)o=o[f];else{o=void 0;break}return typeof o=="function"||Lt(o)?o:u(l)},apply:async(d,i,l)=>{const o="/"+a.map(y=>y.replace(/[A-Z]/g,b=>`-${b.toLowerCase()}`)).join("/"),f=l[0]||{},h=l[1]||{},{query:O,fetchOptions:_,...C}=f,v={...h,..._},M=It(o,n,f);return await t(o,{...v,body:M==="GET"?void 0:{...C,...v?.body||{}},query:O||v?.query,method:M,async onSuccess(y){if(await v?.onSuccess?.(y),!s||v.disableSignal)return;const b=s.filter(c=>c.matcher(o));if(b.length)for(const c of b){const U=r[c.signal];if(!U)return;const p=U.get();setTimeout(()=>{U.set(!p)},10)}}})}})}return u()}function he(e){let t=Re(),n=e.subscribe(r=>{t.value=r});return Se()&&_e(n),t}function xt(e){return`use${Ee(e)}`}function Ct(e){const{baseURL:t,pluginPathMethods:n,pluginsActions:r,pluginsAtoms:s,$fetch:u,$store:a,atomListeners:d}=Pt(e);let i={};for(const[o,f]of Object.entries(s))i[xt(o)]=()=>he(f);function l(o){if(o){const f=he(s.$sessionSignal);return o(`${t}/get-session`,{ref:f}).then(h=>({data:h.data,isPending:!1,error:h.error}))}return i.useSession()}return At({...r,...i,useSession:l,$fetch:u,$store:a},u,n,s,d)}const Mt=Ct({baseURL:"http://localhost:3000"}),{signIn:qt,signUp:Ft,signOut:kt,useSession:Bt}=Mt;export{Mt as a,kt as b,qt as s,Bt as u};
